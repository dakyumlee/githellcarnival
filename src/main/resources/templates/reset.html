<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>🔥 Reset 시뮬레이터</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/arcade.css">
  
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Pretendard, sans-serif;
      margin: 0;
    }

    .main-content {
      max-width: 980px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 2.5rem;
      text-align: center;
      color: #fff;
    }

    .sub {
      color: #bbb;
      text-align: center;
      margin-bottom: 30px;
    }

    .status-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 30px 0;
    }

    .status-card {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .status-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: #6ea8ff;
    }

    .status-title {
      font-weight: 700;
      margin-bottom: 15px;
      font-size: 16px;
      color: #ddd;
    }

    .status-value {
      font-size: 48px;
      font-weight: 900;
      margin: 15px 0;
      color: #6ea8ff;
    }

    .status-desc {
      font-size: 13px;
      color: #999;
      line-height: 1.4;
    }

    .mode-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 30px 0;
    }

    .mode-card {
      background: #1b1b1b;
      border: 2px solid #2b2b2b;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .mode-card:hover {
      transform: translateY(-5px);
      border-color: #444;
    }

    .mode-card.active {
      border-color: #6ea8ff;
      background: #21293a;
    }

    .mode-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .mode-name {
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 18px;
    }

    .mode-desc {
      font-size: 14px;
      color: #bbb;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .mode-hint {
      color: #777;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      background: #0f0f0f;
      padding: 5px 8px;
      border-radius: 4px;
      margin-top: 8px;
    }

    .action-bar {
      display: flex;
      gap: 15px;
      align-items: center;
      margin: 30px 0;
      justify-content: center;
    }

    .btn {
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #e74c3c;
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      background: #c0392b;
    }

    .btn-secondary {
      background: #333;
      color: #fff;
      border: 1px solid #555;
    }

    .btn-secondary:hover {
      background: #444;
      transform: translateY(-1px);
    }

    .result-area {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin: 30px 0;
    }

    .result-panel {
      background: #181818;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 25px;
    }

    .panel-title {
      font-weight: 700;
      margin-bottom: 15px;
      color: #ddd;
    }

    .result-log {
      min-height: 60px;
      font-size: 18px;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .result-hint {
      font-size: 14px;
      color: #bbb;
      font-family: 'Courier New', monospace;
      background: #0f0f0f;
      padding: 10px;
      border-radius: 6px;
      border-left: 3px solid #6ea8ff;
    }

    .avatar-panel {
      text-align: center;
    }

    .avatar {
      font-size: 80px;
      margin: 20px 0;
      transition: all 0.3s ease;
    }

    .score-display {
      font-size: 20px;
      font-weight: bold;
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      background: #222;
    }

    .score-positive { color: #2ecc71; }
    .score-negative { color: #e74c3c; }
    .score-neutral { color: #bbb; }

    @media (max-width: 768px) {
      .status-board, .mode-selector {
        grid-template-columns: 1fr;
      }
      .result-area {
        grid-template-columns: 1fr;
      }
      .action-bar {
        flex-direction: column;
      }
    }
  </style>
</head>
<script src="/js/arcade.js"></script>
<script>window.ghcMountHUD({ showHome:true });</script>
<body>
<header class="hud" id="hud"></header>

<div class="main-content">
  <h1>🔥 Reset 시뮬레이터</h1>
  <div class="sub">soft / mixed / hard 차이를 몸으로 이해해보기</div>
  
  <div class="status-board">
    <div class="status-card">
      <div class="status-title">HEAD (앞선 커밋)</div>
      <div id="kpi-ahead" class="status-value">2</div>
      <div class="status-desc">브랜치가 원격보다 얼마나 앞서는지</div>
    </div>
    <div class="status-card">
      <div class="status-title">Staging Area</div>
      <div id="kpi-staged" class="status-value">1</div>
      <div class="status-desc">git add로 올린 변경사항</div>
    </div>
    <div class="status-card">
      <div class="status-title">Working Tree</div>
      <div id="kpi-working" class="status-value">4</div>
      <div class="status-desc">파일에 남아있는 수정사항</div>
    </div>
  </div>

  <div class="mode-selector">
    <div class="mode-card" data-mode="soft">
      <div class="mode-icon">🪶</div>
      <div class="mode-name">--soft</div>
      <div class="mode-desc">HEAD만 이동하고 변경사항은 스테이징에 보존</div>
      <div class="mode-hint">reset --soft HEAD~1</div>
    </div>
    <div class="mode-card" data-mode="mixed">
      <div class="mode-icon">🔄</div>
      <div class="mode-name">--mixed</div>
      <div class="mode-desc">HEAD와 인덱스를 이동, 변경은 작업트리에 보존</div>
      <div class="mode-hint">reset --mixed HEAD~1</div>
    </div>
    <div class="mode-card" data-mode="hard">
      <div class="mode-icon">💥</div>
      <div class="mode-name">--hard</div>
      <div class="mode-desc">HEAD, 인덱스, 작업트리를 모두 되돌림</div>
      <div class="mode-hint">reset --hard HEAD~1</div>
    </div>
  </div>

  <div class="action-bar">
    <button id="btn-shuffle" class="btn btn-secondary">🎲 무대 셔플</button>
    <button id="btn-execute" class="btn btn-primary">⚡ 실행</button>
  </div>

  <div class="result-area">
    <div class="result-panel">
      <div class="panel-title">실행 결과</div>
      <div id="result-log" class="result-log">모드를 선택하고 실행 버튼을 눌러보세요</div>
      <div id="result-hint" class="result-hint"></div>
    </div>
    <div class="result-panel avatar-panel">
      <div class="panel-title">상태</div>
      <div id="avatar" class="avatar">🧑‍💻</div>
      <div id="score-display" class="score-display score-neutral">점수: 대기중</div>
    </div>
  </div>
</div>

<script>
  let ahead = 2;
  let staged = 1;
  let working = 4;
  let selectedMode = "mixed";

  function updateDisplay() {
    document.getElementById("kpi-ahead").textContent = ahead;
    document.getElementById("kpi-staged").textContent = staged;
    document.getElementById("kpi-working").textContent = working;
  }

  function selectMode(mode) {
    selectedMode = mode;
    document.querySelectorAll(".mode-card").forEach(card => {
      card.classList.remove("active");
    });
    document.querySelector(`[data-mode="${mode}"]`).classList.add("active");
  }

  function shuffleStage() {
    ahead = Math.floor(Math.random() * 3) + 1;
    staged = Math.floor(Math.random() * 3);
    working = Math.floor(Math.random() * 6);
    updateDisplay();
    
    document.getElementById("result-log").textContent = "🎲 무대가 섞였습니다! 새로운 상황에 도전해보세요";
    document.getElementById("result-hint").textContent = "";
    document.getElementById("avatar").textContent = "🧑‍💻";
    
    const scoreDisplay = document.getElementById("score-display");
    scoreDisplay.textContent = "점수: 대기중";
    scoreDisplay.className = "score-display score-neutral";
  }

  function executeReset() {
    const executeBtn = document.getElementById("btn-execute");
    executeBtn.disabled = true;
    executeBtn.textContent = "⏳ 실행중...";
    
    fetch("/api/reset/execute", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        mode: selectedMode,
        aheadCommits: ahead,
        stagedChanges: staged,
        workingChanges: working
      })
    })
    .then(r => r.json())
    .then(data => {
      ahead = data.aheadCommits;
      staged = data.stagedChanges;
      working = data.workingChanges;
      updateDisplay();
      
      document.getElementById("result-log").textContent = data.message;
      document.getElementById("result-hint").textContent = data.stateHint || data.hint;
      document.getElementById("avatar").textContent = data.success ? "😎" : "😡";
      
      const scoreDisplay = document.getElementById("score-display");
      const scoreDiff = data.scoreDiff || 0;
      scoreDisplay.textContent = `점수: ${scoreDiff > 0 ? '+' : ''}${scoreDiff}`;
      scoreDisplay.className = `score-display ${scoreDiff > 0 ? 'score-positive' : scoreDiff < 0 ? 'score-negative' : 'score-neutral'}`;
      
      if (scoreDiff !== 0) {
        ghcAddScore(scoreDiff);
      }
      
      setTimeout(() => {
        executeBtn.disabled = false;
        executeBtn.textContent = "⚡ 실행";
      }, 1000);
    })
    .catch(() => {
      executeBtn.disabled = false;
      executeBtn.textContent = "⚡ 실행";
    });
  }

  document.querySelectorAll(".mode-card").forEach(card => {
    card.addEventListener("click", () => {
      selectMode(card.dataset.mode);
    });
  });

  document.getElementById("btn-shuffle").addEventListener("click", shuffleStage);
  document.getElementById("btn-execute").addEventListener("click", executeReset);

  selectMode("mixed");
  updateDisplay();
</script>
</body>
</html>