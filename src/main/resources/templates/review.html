<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>🤡 코드 리뷰 배틀</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
<link rel="stylesheet" href="/css/arcade.css">
  
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Pretendard, sans-serif;
      margin: 0;
    }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
    }

    h1 {
      text-align: center;
      margin: 0 0 8px;
    }

    .sub {
      text-align: center;
      color: #bbb;
      margin-bottom: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
    }

    #editor {
      height: 520px;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
    }

    .card {
      background: #1e1e1e;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
      padding: 14px;
    }

    .btn {
      background: #e74c3c;
      border: none;
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn:hover {
      background: #c0392b;
    }

    .bar {
      height: 10px;
      background: #2a2a2a;
      border-radius: 6px;
      overflow: hidden;
      margin: 6px 0 12px;
    }

    .fill {
      height: 100%;
      background: #6ea8ff;
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .avatar {
      font-size: 56px;
      text-align: center;
      margin-top: 8px;
    }

    ul {
      margin: 8px 0 0 16px;
      color: #bbb;
    }

    .back {
      position: fixed;
      left: 16px;
      top: 16px;
      background: #333;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      text-decoration: none;
    }

    .back:hover {
      background: #555;
    }
  </style>
</head>
<script src="/js/arcade.js"></script>
<script>window.ghcMountHUD({ showHome:true });</script>
<body>
<header class="hud" id="hud"></header>
  <a class="back" href="/">← 로비</a>
  <div class="wrap">
    <h1>🤡 코드 리뷰 배틀</h1>
    <div class="sub">제한 시간 느낌으로 리팩토링 포인트를 찾아보세요</div>
    <div class="grid">
      <div class="card">
        <div id="editor"></div>
        <button id="run" class="btn" style="margin-top:10px">리뷰 요청</button>
      </div>
      <div class="card">
        <div>가독성 <span id="rval">0</span></div>
        <div class="bar">
          <div id="rbar" class="fill" style="width:0%"></div>
        </div>
        <div>성능 <span id="pval">0</span></div>
        <div class="bar">
          <div id="pbar" class="fill" style="width:0%"></div>
        </div>
        <div>AI 빡침 <span id="aval">0</span></div>
        <div class="bar">
          <div id="abar" class="fill" style="width:0%"></div>
        </div>
        <div id="msg" style="margin-top:6px;font-size:18px"></div>
        <div class="avatar" id="avatar">🧑‍💻</div>
        <div style="margin-top:8px">리팩토링 팁</div>
        <ul id="tips"></ul>
        <div id="hint" style="color:#bbb;margin-top:6px"></div>
      </div>
    </div>
  </div>
  
  <script>
    let editor;

    require.config({
      paths: {
        'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs'
      }
    });

    require(['vs/editor/editor.main'], function() {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: `public class Demo {
  public static void main(String[] args){
    int sum=0;
    for(int i=0;i<200;i++){
      for(int j=0;j<50;j++){
        sum+=i*j;
      }
    }
    if(sum>0){
      if(sum%2==0){
        System.out.println("even");
      }else{
        System.out.println("odd");
      }
    }
  }
}`,
        language: "java",
        theme: "vs-dark",
        automaticLayout: true
      });
    });

    function fill(element, value) {
      element.style.width = Math.min(100, Math.max(0, value)) + "%";
    }

    document.getElementById("run").addEventListener("click", () => {
      fetch("/api/review/analyze", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({code: editor.getValue()})
      })
      .then(r => r.json())
      .then(d => {
        document.getElementById("rval").innerText = d.readability;
        document.getElementById("pval").innerText = d.performance;
        document.getElementById("aval").innerText = d.aiAnger;
        
        fill(document.getElementById("rbar"), d.readability);
        fill(document.getElementById("pbar"), d.performance);
        fill(document.getElementById("abar"), d.aiAnger);
        
        document.getElementById("msg").innerText = d.message + ` (라인 ${d.lines})`;
        document.getElementById("avatar").innerText = d.aiAnger < 30 ? "😎" : (d.aiAnger < 60 ? "😐" : "😡");
        document.getElementById("tips").innerHTML = (d.tips || []).map(t => `<li>${t}</li>`).join("") || "<li>양호</li>";
        document.getElementById("hint").innerText = d.hint;
      });
    });
  </script>
</body>
</html>