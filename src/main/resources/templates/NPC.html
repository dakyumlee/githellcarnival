<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>😡 팀원 NPC 시스템</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/arcade.css">
  
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Pretendard, sans-serif;
      margin: 0;
    }

    .main-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      font-size: 2.8rem;
      margin: 20px 0;
      color: #fff;
    }

    .sub {
      text-align: center;
      color: #bbb;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .global-rage-meter {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
      text-align: center;
    }

    .meter-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 15px;
    }

    .meter-display {
      font-size: 3rem;
      font-weight: 900;
      margin: 15px 0;
      transition: all 0.3s ease;
    }

    .meter-peaceful { color: #2ecc71; }
    .meter-tense { color: #f39c12; }
    .meter-chaos { color: #e74c3c; }

    .meter-bar {
      width: 100%;
      height: 20px;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      margin: 15px 0;
    }

    .meter-fill {
      height: 100%;
      border-radius: 10px;
      transition: all 0.5s ease;
    }

    .fill-peaceful { background: #2ecc71; }
    .fill-tense { background: #f39c12; }
    .fill-chaos { background: #e74c3c; }

    .slack-simulator {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 15px;
      margin: 25px 0;
      overflow: hidden;
    }

    .slack-header {
      background: #4a154b;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-bottom: 1px solid #6b46c1;
    }

    .slack-logo {
      font-size: 1.2rem;
      font-weight: 900;
      color: white;
    }

    .channel-name {
      color: #e2e8f0;
      font-weight: 600;
    }

    .online-indicator {
      background: #2ecc71;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-left: auto;
    }

    .chat-area {
      height: 350px;
      overflow-y: auto;
      padding: 15px;
      background: #1a1a1a;
    }

    .message {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      padding: 8px;
      border-radius: 8px;
      transition: background 0.3s ease;
    }

    .message:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .message.rage {
      background: rgba(231, 76, 60, 0.1);
      border-left: 3px solid #e74c3c;
    }

    .message.praise {
      background: rgba(46, 204, 113, 0.1);
      border-left: 3px solid #2ecc71;
    }

    .avatar {
      width: 35px;
      height: 35px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
      background: #4a154b;
    }

    .message-content {
      flex: 1;
    }

    .username {
      font-weight: 700;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .timestamp {
      color: #718096;
      font-size: 0.75rem;
    }

    .message-text {
      color: #e2e8f0;
      line-height: 1.4;
    }

    .team-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .team-member {
      background: #1e1e1e;
      border: 2px solid #333;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
    }

    .team-member.happy {
      border-color: #2ecc71;
      background: #0f2a1f;
    }

    .team-member.neutral {
      border-color: #f39c12;
      background: #2a1f0f;
    }

    .team-member.angry {
      border-color: #e74c3c;
      background: #2a0f0f;
    }

    .member-avatar {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .member-name {
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .member-role {
      color: #bbb;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .rage-bar {
      background: #333;
      height: 10px;
      border-radius: 5px;
      overflow: hidden;
      margin: 15px 0;
    }

    .rage-fill {
      height: 100%;
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .rage-fill.low { background: #2ecc71; }
    .rage-fill.medium { background: #f39c12; }
    .rage-fill.high { background: #e74c3c; }

    .member-quote {
      font-style: italic;
      color: #bbb;
      font-size: 0.9rem;
      min-height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .action-center {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 15px;
      padding: 25px;
      margin: 30px 0;
      text-align: center;
    }

    .action-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 20px;
      color: #fff;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .action-btn {
      padding: 15px 20px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .btn-good {
      background: #2ecc71;
      color: #fff;
    }

    .btn-good:hover {
      transform: translateY(-2px);
      background: #27ae60;
    }

    .btn-bad {
      background: #e74c3c;
      color: #fff;
    }

    .btn-bad:hover {
      transform: translateY(-2px);
      background: #c0392b;
    }

    .btn-neutral {
      background: #f39c12;
      color: #fff;
    }

    .btn-neutral:hover {
      transform: translateY(-2px);
      background: #e67e22;
    }

    .consequence-alert {
      background: rgba(231, 76, 60, 0.1);
      border: 2px solid #e74c3c;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      display: none;
    }

    .alert-title {
      font-weight: 800;
      color: #e74c3c;
      margin-bottom: 8px;
    }

    @media (max-width: 768px) {
      .team-dashboard {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<script src="/js/arcade.js"></script>
<script>window.ghcMountHUD({ showHome:true });</script>
<body>
<header class="hud" id="hud"></header>

<div class="main-content">
  <h1>😡 팀원 NPC 시스템</h1>
  <div class="sub">당신의 실수에 반응하는 살아있는 팀원들</div>

  <div class="global-rage-meter">
    <div class="meter-title">🌡️ 사무실 분위기</div>
    <div class="meter-display meter-peaceful" id="atmosphere-display">😊 평화</div>
    <div class="meter-bar">
      <div class="meter-fill fill-peaceful" id="global-meter-fill" style="width: 0%"></div>
    </div>
    <div id="atmosphere-desc">모두가 행복하게 일하고 있습니다</div>
  </div>

  <div class="consequence-alert" id="consequence-alert">
    <div class="alert-title">⚠️ 경고: 팀 분위기 악화</div>
    <div id="consequence-text">팀원들의 불만이 임계점에 도달했습니다!</div>
  </div>

  <div class="slack-simulator">
    <div class="slack-header">
      <div class="slack-logo">Slack</div>
      <div class="channel-name">#dev-team</div>
      <div class="online-indicator"></div>
    </div>
    <div class="chat-area" id="chat-area">
      <div class="message">
        <div class="avatar">👋</div>
        <div class="message-content">
          <div class="username">SlackBot <span class="timestamp">지금</span></div>
          <div class="message-text">팀원들이 당신의 Git 활동을 지켜보고 있습니다...</div>
        </div>
      </div>
    </div>
  </div>

  <div class="team-dashboard" id="team-dashboard">
  </div>

  <div class="action-center">
    <div class="action-title">🎮 시뮬레이션 액션</div>
    <div class="action-buttons">
      <button class="action-btn btn-good" onclick="triggerAction('success')">
        ✅ 완벽한 커밋
      </button>
      <button class="action-btn btn-neutral" onclick="triggerAction('minor-bug')">
        🐛 사소한 버그
      </button>
      <button class="action-btn btn-bad" onclick="triggerAction('major-bug')">
        💥 치명적 버그
      </button>
      <button class="action-btn btn-bad" onclick="triggerAction('build-break')">
        🔥 빌드 깨짐
      </button>
      <button class="action-btn btn-bad" onclick="triggerAction('force-push')">
        ⚡ Force Push
      </button>
      <button class="action-btn btn-bad" onclick="triggerAction('delete-branch')">
        💀 브랜치 삭제
      </button>
    </div>
  </div>
</div>

<script>
  let gameData = null;

  function loadTeamStatus() {
    fetch('/api/team/status')
      .then(response => response.json())
      .then(data => {
        gameData = data;
        updateUI(data);
      })
      .catch(error => {
        console.error('Error loading team status:', error);
      });
  }

  function updateUI(data) {
    updateGlobalMeter(data.globalRage, data.atmosphere);
    updateTeamMembers(data.members);
    updateSlackMessages(data.recentMessages);
  }

  function updateGlobalMeter(rage, atmosphere) {
    const display = document.getElementById('atmosphere-display');
    const fill = document.getElementById('global-meter-fill');
    const desc = document.getElementById('atmosphere-desc');
    
    fill.style.width = rage + '%';
    
    display.className = 'meter-display meter-' + atmosphere;
    fill.className = 'meter-fill fill-' + atmosphere;
    
    switch (atmosphere) {
      case 'peaceful':
        display.textContent = '😊 평화';
        desc.textContent = '모두가 행복하게 일하고 있습니다';
        break;
      case 'tense':
        display.textContent = '😐 긴장';
        desc.textContent = '약간의 스트레스가 감지됩니다';
        break;
      case 'chaos':
        display.textContent = '😡 카오스';
        desc.textContent = '팀원들이 매우 화가 났습니다!';
        break;
    }
  }

  function updateTeamMembers(members) {
    const dashboard = document.getElementById('team-dashboard');
    dashboard.innerHTML = '';
    
    Object.entries(members).forEach(([id, member]) => {
      const memberDiv = document.createElement('div');
      memberDiv.className = `team-member ${getMemberClass(member.rage)}`;
      memberDiv.innerHTML = `
        <div class="member-avatar">${member.avatar}</div>
        <div class="member-name">${member.name}</div>
        <div class="member-role">${member.role}</div>
        <div class="rage-bar">
          <div class="rage-fill ${getRageFillClass(member.rage)}" style="width: ${member.rage}%"></div>
        </div>
        <div class="member-quote">"${member.quote}"</div>
      `;
      dashboard.appendChild(memberDiv);
    });
  }

  function updateSlackMessages(messages) {
    const chatArea = document.getElementById('chat-area');
    
    messages.forEach(msg => {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${msg.type || ''}`;
      messageDiv.innerHTML = `
        <div class="avatar">${msg.avatar}</div>
        <div class="message-content">
          <div class="username">${msg.user} <span class="timestamp">방금</span></div>
          <div class="message-text">${msg.text}</div>
        </div>
      `;
      
      chatArea.appendChild(messageDiv);
      chatArea.scrollTop = chatArea.scrollHeight;
      
      if (chatArea.children.length > 15) {
        chatArea.removeChild(chatArea.firstChild);
      }
    });
  }

  function getMemberClass(rage) {
    if (rage < 30) return 'happy';
    if (rage < 70) return 'neutral';
    return 'angry';
  }

  function getRageFillClass(rage) {
    if (rage < 30) return 'low';
    if (rage < 70) return 'medium';
    return 'high';
  }

  function triggerAction(actionType) {
    fetch('/api/team/action', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: actionType })
    })
    .then(response => response.json())
    .then(data => {
      updateGlobalMeter(data.globalRage, data.atmosphere);
      updateTeamMembers(data.members);
      
      if (data.newMessages && data.newMessages.length > 0) {
        setTimeout(() => {
          updateSlackMessages(data.newMessages);
        }, 500);
      }
      
      if (data.consequence) {
        const alert = document.getElementById('consequence-alert');
        const text = document.getElementById('consequence-text');
        text.textContent = data.consequence;
        alert.style.display = 'block';
        
        if (data.globalRage > 90) {
          setTimeout(() => {
            alert('🚨 ' + data.consequence);
          }, 2000);
        }
      } else {
        document.getElementById('consequence-alert').style.display = 'none';
      }
    })
    .catch(error => {
      console.error('Error triggering action:', error);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadTeamStatus();
    
    setTimeout(() => {
      updateSlackMessages([
        { 
          user: 'SlackBot', 
          avatar: '🤖', 
          text: '새로운 개발자가 팀에 합류했습니다!',
          type: 'neutral'
        }
      ]);
    }, 2000);
  });
</script>
</body>
</html>