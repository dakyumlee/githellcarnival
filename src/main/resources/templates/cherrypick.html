<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>🍒 체리픽 러시</title>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/arcade.css">
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: 'Pretendard', sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.5rem;
      color: #fff;
    }
    p {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: #ccc;
    }
    
    .difficulty-selector {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 16px;
      margin: 20px auto;
      width: 60%;
    }

    .mode-toggle {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .mode-option {
      background: #232323;
      border: 1px solid #343434;
      border-radius: 10px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-option:hover {
      transform: translateY(-2px);
    }

    .mode-option.active {
      border-color: #6ea8ff;
      background: #21293a;
    }

    .mode-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .mode-name {
      font-weight: 700;
      margin-bottom: 6px;
    }

    .mode-desc {
      font-size: 14px;
      color: #bbb;
      margin-bottom: 4px;
    }

    .mode-stats {
      font-size: 12px;
      color: #888;
    }

    #commit-list {
      margin: 20px auto;
      width: 60%;
      text-align: left;
    }
    .commit {
      padding: 12px;
      margin: 6px 0;
      border: 1px solid #444;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .commit:hover {
      background: #333;
    }
    .commit.selected {
      background: #2ecc71;
      color: black;
      font-weight: bold;
    }
    
    .execute-area {
      margin: 20px 0;
    }
    
    button {
      margin-top: 20px;
      padding: 12px 28px;
      font-size: 18px;
      background: #e74c3c;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s;
    }
    button:hover {
      background: #c0392b;
    }
    #avatar {
      font-size: 64px;
      margin: 30px 0 10px;
    }
    #log {
      font-size: 20px;
      margin-top: 10px;
    }
    #hint {
      font-size: 16px;
      margin-top: 8px;
      color: #aaa;
    }
    #score {
      font-size: 18px;
      margin-top: 8px;
      font-weight: bold;
    }
  </style>
</head>
<script src="/js/arcade.js"></script>
<script>window.ghcMountHUD({ showHome:true });</script>
<body>
<header class="hud" id="hud"></header>
  <h1>🍒 체리픽 러시</h1>
  <p>버그 픽스 커밋만 골라 체리픽하세요!</p>

  <div class="difficulty-selector">
    <h3>🎯 난이도 선택</h3>
    <div class="mode-toggle">
      <div class="mode-option active" data-mode="safe">
        <div class="mode-icon">🛡️</div>
        <div class="mode-name">안전 모드</div>
        <div class="mode-desc">낮은 리스크, 기본 점수</div>
        <div class="mode-stats">성공률 ↑ / 점수 기본</div>
      </div>
      <div class="mode-option" data-mode="risky">
        <div class="mode-icon">⚡</div>
        <div class="mode-name">고위험 모드</div>
        <div class="mode-desc">높은 리스크, 2배 점수</div>
        <div class="mode-stats">성공률 ↓ / 점수 2x</div>
      </div>
    </div>
  </div>

  <div id="commit-list"></div>

  <div class="execute-area">
    <button onclick="executeCherryPick()">🍒 Cherry-pick 실행!</button>
  </div>

  <div id="avatar">🧑‍💻</div>
  <div id="log"></div>
  <div id="hint"></div>
  <div id="score"></div>

  <script>
    let selected = [];
    let difficulty = 'safe';

    function loadCommits() {
      fetch('/api/cherrypick/commits')
        .then(res => res.json())
        .then(data => {
          const list = Object.entries(data)
            .map(([hash, msg]) => `
              <div class="commit" onclick="toggleCommit('${hash}', this)">
                [${hash}] ${msg}
              </div>
            `).join("");
          document.getElementById("commit-list").innerHTML = list;
        });
    }

    function toggleCommit(hash, element) {
      if (selected.includes(hash)) {
        selected = selected.filter(h => h !== hash);
        element.classList.remove("selected");
      } else {
        selected.push(hash);
        element.classList.add("selected");
      }
    }

    function setDifficulty(mode) {
      difficulty = mode;
      document.querySelectorAll('.mode-option').forEach(el => el.classList.remove('active'));
      document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
    }

    function executeCherryPick() {
      fetch('/api/cherrypick/execute', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ selected, difficulty })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("log").innerText = data.message;
        document.getElementById("hint").innerText = data.hint;
        document.getElementById("avatar").innerText = data.success ? "😎" : "😡";
        document.getElementById("score").innerText = `점수: ${data.scoreDiff > 0 ? '+' : ''}${data.scoreDiff}`;
        
        if (data.scoreDiff) {
          ghcAddScore(data.scoreDiff);
        }
      });
    }

    document.querySelectorAll('.mode-option').forEach(option => {
      option.addEventListener('click', () => {
        setDifficulty(option.dataset.mode);
      });
    });

    loadCommits();
  </script>
</body>
</html>